<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Fantasy Team Planner</title>
    <style>
        :root {
            --pitch-green: #2d5a27;
            --ffh-green: #00ff87;
            --fdr-easy: #00ff87;
            --fdr-hard: #ff005a;
        }

        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; margin: 0; }
        
        .app-container { display: flex; height: 100vh; }

        /* Sidebar Styling */
        .sidebar { width: 300px; background: #222; padding: 20px; border-right: 1px solid #444; }
        
        /* Pitch Styling */
        .main-content { flex-grow: 1; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .pitch {
            width: 100%; max-width: 700px; height: 600px;
            background: linear-gradient(to bottom, var(--pitch-green), #3e8e41);
            border: 4px solid white; border-radius: 10px;
            display: flex; flex-direction: column; justify-content: space-around;
            position: relative;
        }

        .row { display: flex; justify-content: center; gap: 15px; min-height: 110px; }

        /* Player Card */
        .slot { width: 90px; height: 110px; border: 1px dashed rgba(255,255,255,0.2); border-radius: 5px; }
        
        .player-card {
            background: white; color: #333; border-radius: 4px; padding: 5px;
            text-align: center; font-size: 11px; cursor: grab;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .player-card.dragging { opacity: 0.5; }
        
        .xp-badge { background: #333; color: var(--ffh-green); font-weight: bold; padding: 2px; border-radius: 3px; }

        /* Buttons */
        button {
            background: var(--ffh-green); border: none; padding: 10px 20px;
            font-weight: bold; border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 10px;
        }
        
        .stats-panel { background: #333; padding: 15px; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="sidebar">
        <h2>Planner Pro</h2>
        <button onclick="handleAutoPick()">ðŸ¤– AI Optimize Team</button>
        <button onclick="fetchLatestData()" style="background: #444; color: white;">ðŸ”„ Refresh FPL Data</button>
        
        <div class="stats-panel">
            <h4>Team Metrics</h4>
            <p>Projected GW Points: <span id="total-xp" style="color:var(--ffh-green)">0.0</span></p>
            <p>Bank: Â£<span id="bank">100.0</span>m</p>
        </div>
    </div>

    <div class="main-content">
        <div class="pitch" id="pitch">
            <div class="row" id="GKP-row"></div>
            <div class="row" id="DEF-row"></div>
            <div class="row" id="MID-row"></div>
            <div class="row" id="FWD-row"></div>
        </div>
    </div>
</div>

<script>
    // --- MOCK DATA FOR DEMO ---
    let mySquad = [
        { id: 1, name: "Pickford", pos: "GKP", xP: 4.5, price: 5.0 },
        { id: 2, name: "Gabriel", pos: "DEF", xP: 5.2, price: 6.0 },
        { id: 3, name: "Gvardiol", pos: "DEF", xP: 4.8, price: 6.0 },
        { id: 4, name: "Trent", pos: "DEF", xP: 6.1, price: 7.0 },
        { id: 5, name: "Salah", pos: "MID", xP: 8.5, price: 12.5 },
        { id: 6, name: "Palmer", pos: "MID", xP: 7.9, price: 10.5 },
        { id: 7, name: "Saka", pos: "MID", xP: 7.2, price: 10.0 },
        { id: 8, name: "Foden", pos: "MID", xP: 6.5, price: 9.5 },
        { id: 9, name: "Haaland", pos: "FWD", xP: 9.2, price: 15.0 },
        { id: 10, name: "Watkins", pos: "FWD", xP: 5.5, price: 9.0 },
        { id: 11, name: "Isak", pos: "FWD", xP: 6.0, price: 8.5 }
    ];

    // --- RENDER LOGIC ---
    function renderTeam(players) {
        // Clear rows
        ['GKP', 'DEF', 'MID', 'FWD'].forEach(pos => document.getElementById(`${pos}-row`).innerHTML = '');

        players.forEach(p => {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.ondrop = drop;
            slot.ondragover = allowDrop;

            const card = document.createElement('div');
            card.className = 'player-card';
            card.draggable = true;
            card.id = `player-${p.id}`;
            card.ondragstart = drag;
            card.innerHTML = `
                <b>${p.name}</b><br>
                <span class="xp-badge">${p.xP} xP</span><br>
                Â£${p.price}m
            `;
            
            slot.appendChild(card);
            document.getElementById(`${p.pos}-row`).appendChild(slot);
        });

        calculateTotalXP(players);
    }

    // --- DRAG & DROP LOGIC ---
    function allowDrop(ev) { ev.preventDefault(); }
    function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
    function drop(ev) {
        ev.preventDefault();
        const data = ev.dataTransfer.getData("text");
        const draggedEl = document.getElementById(data);
        const targetSlot = ev.target.closest('.slot');
        
        if (targetSlot && targetSlot !== draggedEl.parentNode) {
            const currentResident = targetSlot.children[0];
            const oldSlot = draggedEl.parentNode;
            
            targetSlot.appendChild(draggedEl);
            if (currentResident) oldSlot.appendChild(currentResident);
        }
    }

    // --- AI OPTIMIZATION ---
    function handleAutoPick() {
        // Sort by xP and re-render
        const optimized = [...mySquad].sort((a, b) => b.xP - a.xP);
        renderTeam(optimized);
        alert("AI: Lineup optimized based on highest Predicted Points!");
    }

    function calculateTotalXP(players) {
        const total = players.reduce((sum, p) => sum + p.xP, 0);
        document.getElementById('total-xp').innerText = total.toFixed(1);
    }

    // Initial Load
    renderTeam(mySquad);
</script>
</body>
</html>